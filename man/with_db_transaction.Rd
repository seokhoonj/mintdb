% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run.R
\name{with_db_transaction}
\alias{with_db_transaction}
\title{Evaluate Expressions Within a Database Transaction}
\usage{
with_db_transaction(code)
}
\arguments{
\item{code}{Expressions to evaluate within the transaction.}
}
\value{
Invisibly returns the result of the evaluated expression(s)
after a successful commit.
}
\description{
Executes one or more R expressions inside a database transaction context.
If an error occurs, the transaction is automatically rolled back;
otherwise it is committed. Works with both regular connections and pools.
}
\details{
This function wraps \code{DBI::dbBegin()}, \code{DBI::dbCommit()}, and
\code{DBI::dbRollback()} with automatic error handling.
It is analogous to \verb{withr::with_*()} helpers for temporary contexts.
}
\examples{
\dontrun{
set_db_conn_info(driver = "sqlite", filepath = "data/test.sqlite")
set_db_conn()

with_db_transaction({
  exec_db("INSERT INTO logs(message) VALUES (?)", params = list("start"))
  exec_db("INSERT INTO logs(message) VALUES (?)", params = list("middle"))
  stop("Something went wrong!")  # rollback
  exec_db("INSERT INTO logs(message) VALUES (?)", params = list("end"))
})

set_db_disconn()
}
}
\seealso{
\code{\link[=exec_db]{exec_db()}}, \code{\link[=query_db]{query_db()}}
}
